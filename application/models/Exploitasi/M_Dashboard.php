<?php defined('BASEPATH') OR exit('No direct script access allowed');
class M_Dashboard extends CI_Model {

	protected $exploitasi = "ak_data_exploitasi";
	protected $bidang = "ak_data_bidang";
	protected $divisi = "ak_data_divisi";
	
	public function get_list_data() {
		return $this->db->where(
			$this->exploitasi.'.deleted',false
		)->join(
			$this->bidang,
			$this->bidang.'.bidang_id='.
			$this->exploitasi.'.bidang_id'
		)->join(
			$this->divisi,
			$this->divisi.'.divisi_id='.
			$this->exploitasi.'.divisi_id'
		)->get($this->exploitasi)->result();
	}

	public function get_data() {
		return $this->db->where(
			'exploitasi_id',$this->input->post('exploitasi_id')
		)->get($this->exploitasi)->row();
	}

	public function get_id() {
		$res = $this->db->get($this->exploitasi)->num_rows();
		return "EXP".date('ymd').str_pad($res+1, 4, "0", STR_PAD_LEFT);
	}

	public function check_pr() {
		$data = $this->db->where(
			'exploitasi_pr_number',$this->input->post('exploitasi_pr_number')
		)->get($this->exploitasi)->num_rows();
		if($data==0) {
			return TRUE;
		} else {
			return FALSE;
		}
	}

	public function check_po() {
		$data = $this->db->where(
			'exploitasi_po_number',$this->input->post('exploitasi_po_number')
		)->get($this->exploitasi)->num_rows();
		if($data==0) {
			return TRUE;
		} else {
			return FALSE;
		}
	}

	public function check_kontrak() {
		$data = $this->db->where(
			'exploitasi_no_kontrak',$this->input->post('exploitasi_no_kontrak')
		)->get($this->exploitasi)->num_rows();
		if($data==0) {
			return TRUE;
		} else {
			return FALSE;
		}
	}

	public function simpan($data) { return $this->db->insert($this->exploitasi,$data); }

	public function edit($data) {
		return $this->db->where(
			'exploitasi_id', $this->input->post('exploitasi_id')
		)->update($this->exploitasi,$data);
	}

	public function hapus($data) {
		return $this->db->where(
			'exploitasi_id', $this->input->post('exploitasi_id')
		)->update($this->exploitasi,$data);
	}

	public function options() {
		$res = $this->db->select(
			"exploitasi_id as id,exploitasi_id as value,exploitasi_nama as text"
		)->where(
			'deleted', FALSE
		)->get($this->exploitasi)->result();
		return $res;
	}

}